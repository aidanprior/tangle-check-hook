#+TITLE: tangle-check-hook
#+AUTHOR: Aidan Prior
#+DATE: <2024-06-09>
#+OPTIONS: toc:nil
#+PROPERTY: header-args :tangle no :eval no

* tangle-check-hook

This repository provides a pre-commit hook for Org-mode users who want to ensure their code blocks are properly tangled before committing. The hook is designed to run a custom shell script that checks for tangled code in your Org files, and can be easily integrated into your project's pre-commit configuration.

*Features:*
- Ensures code blocks in Org files are up-to-date and tangled.
- Prevents accidental commits of outdated or untangled code.
- Avoids drift by ensuring the tangled files are not edited directly.
- Optional automatic `.gitattributes` syncing to mark tangled files as generated.

* Usage
** 0. Prequisites
- Ensure you have `pre-commit` installed. You can install it via pip:

  ```bash
  pip install pre-commit
  ```
- Ensure you have Emacs installed with org-mode available in your PATH.

** 1. Add to your .pre-commit-config.yaml

#+begin_src yaml
repos:
- repo: https://github.com/aidanprior/tangle-check-hook
  rev: v0.1.0  # Use the latest tag or commit
  hooks:
    - id: tangle-check
      # Optional: Enable .gitattributes syncing for generated files
      args: ['--sync-gitattributes']
#+end_src

** 2. Install the hook

#+begin_src shell
pre-commit install
#+end_src

* .gitattributes Integration

When enabled with `--sync-gitattributes`, the hook will automatically maintain your `.gitattributes` file to mark tangled files as generated code. This helps GitHub's linguist correctly identify generated files and exclude them from language statistics.

** How it works:
- Automatically adds `linguist-generated=true` for all tangled files
- Preserves existing `.gitattributes` entries that you've manually added
- Removes old generated file entries that are no longer tangled targets  
- Supports keeping specific generated files using comment syntax: `# tangle-check: keep`

** Example `.gitattributes` output:
#+begin_src
# Your custom attributes are preserved
*.pdf binary
documentation/*.md linguist-documentation

# Keep specific generated files from being overwritten
special-generated.py linguist-generated=true # tangle-check: keep

# Generated by tangle-check-hook - tangled files marked as generated  
src/main.py linguist-generated=true
config/settings.yml linguist-generated=true
#+end_src


* License

GPL License. See [[./LICENSE][LICENSE]] for details.
